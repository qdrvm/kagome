#
# Copyright Quadrivium LLC
# All Rights Reserved
# SPDX-License-Identifier: Apache-2.0
#

name: Zombie-Tests

on:
  push:
    branches:
      - "test/polkadot-functional-zombietests"
  workflow_dispatch: 

jobs:
  zombie-tests:
    strategy:
      fail-fast: false
      matrix:
        options:
          - name: "PVF preparation & execution time"
            test: "test-polkadot-functional-0001-parachains-pvf"
          - name: "Disputes initiation, conclusion and lag"
            test: "test-polkadot-functional-0002-parachains-disputes"
          - name: "BEEFY voting and finality, test MMR proofs. Assumes Rococo sessions of 1 minute"
            test: "test-polkadot-functional-0003-beefy-and-mmr"
          - name: "Dispute finality lag when 1/3 of parachain validators always attempt to include an invalid block"
            test: "test-polkadot-functional-0004-parachains-garbage-candidate"
          - name: "Past-session dispute slashing"
            test: "test-polkadot-functional-0005-parachains-disputes-past-session"
          - name: "Test if parachains make progress with most of approvals being tranch0"
            test: "test-polkadot-functional-0006-parachains-max-tranche0"
          - name: "Test if disputes triggered on finalized blocks within scope always end as valid"
            test: "test-polkadot-functional-0007-dispute-freshly-finalized"
          - name: "Test if disputes triggered on finalized blocks out of scope never get to be confirmed and concluded"
            test: "test-polkadot-functional-0008-dispute-old-finalized"
          - name: "Approval voting coalescing does not lag finality"
            test: "test-polkadot-functional-0009-approval-voting-coalescing"
          - name: "Test validator disabling effects"
            test: "test-polkadot-functional-0010-validator-disabling"
          - name: "Test we are producing blocks at 6 seconds clip"
            test: "test-polkadot-functional-0011-async-backing-6-seconds-rate"
    runs-on: [ actions-runner-controller ]
    timeout-minutes: 120
    steps:
      - name: Set owner of working dir recurively
        run: sudo chown -R $(whoami) .
      - uses: actions/checkout@dc323e67f16fb5f7663d20ff7941f27f5809e9b6
      - name: build zombie-tester
        working-directory: ./zombienet/docker
        run: make tester
      - name: Run test
        working-directory: ./zombienet/docker
        run: make ${{ matrix.options.test }}
